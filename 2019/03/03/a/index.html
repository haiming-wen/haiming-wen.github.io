<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>a | Himwen_</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="居居与居">
<meta property="og:type" content="article">
<meta property="og:title" content="a">
<meta property="og:url" content="haiming-wen.github.io/2019/03/03/a/index.html">
<meta property="og:site_name" content="Himwen_">
<meta property="og:description" content="居居与居">
<meta property="og:updated_time" content="2019-03-03T07:41:22.997Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="a">
<meta name="twitter:description" content="居居与居">
  
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Himwen_</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">记录生活</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="Zoeken"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="haiming-wen.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-a" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/03/03/a/" class="article-date">
  <time datetime="2019-03-03T07:41:22.000Z" itemprop="datePublished">2019-03-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      第一
    </h1>
    </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://github.com/haiming-wen/haiming-wen.github.io/blob/master/images/a1.png" alt=""></p>
<blockquote>
<p><strong>计算机网络-TCP/IP HTTP Conclusion</p>
<blockquote>
<ul>
<li>第一</li>
  <li> 
--2019.03.03</li>
<li>
    为什么收到 Server 端的确认之后，Client 还需要进行第三次“握手”呢？

采用三次握手是为了防止失效的连接请求报文段突然又传送到主机 B ，因而产生错误。


“已失效的连接请求报文段”的产生在这样一种情况下： client 发出的第一个连接请求报 文段并没有丢失，而是在某个网络结点长时间的滞留了（因为网络并发量很大在某结点被
阻塞了），以致延误到连接释放以后的某个时间才到达 server。本来这是一个早已失效的 报文段。但 server 收到此失效的连接请求报文段后，就误认为是 client 再次发出的一个新 的连接请求。于是就向 client 发出确认报文段，同意建立连接。假设不采用“三次握手”， 那么只要 server 发出确认，新的连接就建立了。由于现在 client 并没有发出建立连接的请 求，因此不会理睬 server 的确认，也不会向 server 发送数据。但 server 却以为新的运输 连接已经建立，并一直等待 client 发来数据。这样，server 的很多资源就白白浪费掉了。 采用“三次握手”的办法可以防止上述现象发生。例如刚才那种情况，client 不会向 server 的 确认发出确认。server 由于收不到确认，就知道 client 并没有要求建立连接。”。主要目的 防止 server 端一直等待，浪费资源。

1.1.3

为什么要 4 次挥手？

确保数据能够完成传输。 但关闭连接时，当收到对方的 FIN 报文通知时，它仅仅表示对方没有数据发送给你了； 但未必你所有的数据都全部发送给对方了，所以你可以未必会马上会关闭 SOCKET,也即你可 能还需要发送一些数据给对方之后，再发送 FIN 报文给对方来表示你同意现在可以关闭连 接了，所以它这里的 ACK 报文和 FIN 报文多数情况下都是分开发送的。 TCP 协议是一种面向连接的、可靠的、基于字节流的运输层通信协议。TCP 是全双工模式，这就意味着，当主机 1 发出 FIN 报文段时，只是表示主机 1 已经没有数据要发送了， 主机 1 告诉主机 2，它的数据已经全部发送完毕了；但是，这个时候主机 1 还是可以接受来 自主机 2 的数据；当主机 2 返回 ACK 报文段时，表示它已经知道主机 1 没有数据发送了， 但是主机 2 还是可以发送数据到主机 1 的；当主机 2 也发送了 FIN 报文段时，这个时候就 表示主机 2 也没有数据要发送了，就会告诉主机 1，我也没有数据要发送了，之后彼此就会 愉快的中断这次 TCP 连接。

 1.1.4

如何消除大量 TCP 短连接引发的 TIME_WAIT？

可以改为长连接，但代价较大，长连接太多会导致服务器性能问题

 修改 ipv4.ip_local_port_range，增大可用端口范围，但只能缓解问题，不能根本 解决问题

1.1.5

当关闭连接时最后一个 ACK 丢失怎么办？

最后一个 ACK 丢失的话，TCP 就会认为它的 FIN 丢失，进行重发 FIN。 在客户端收到 FIN 后，就会设置一个 2MSL 计时器，2MSL 计时器可以使客户等 待足够长的时间，使得在 ACK 丢失的情况下，可以等到下一个 FIN 的到来。如 果在TIME－WAIT状态汇总有一个新的 FIN到达了，客户就会发送一个新的ACK， 并重新设置 2MSL 计时器。

2.1

TCP 如 何 保 证 可 靠 传 输 ？（重点！！！）

0、在传递数据之前，会有三次握手来建立连接。

1、应用数据被分割成 TCP 认为最适合发送的数据块（按字节编号，合理分片）。这和 UDP 完全不同，应用程序产生的数据报长度将保持不变。 (将数据截断为合理的长度)
2、当 TCP 发出一个段后，它启动一个定时器，等待目的端确认收到这个报文段。如果不 能及时收到一个确认，将重发这个报文段。(超时重发)

3、当 TCP 收到发自 TCP 连接另一端的数据，它将发送一个确认。这个确认不是立即发送， 通常将推迟几分之一秒 。(对于收到的请求，给出确认响应) (之所以推迟，可能是要对包 做完整校验)。
4、TCP 将保持它首部和数据的检验和。这是一个端到端的检验和，目的是检测数据在传 输过程中的任何变化。如果收到段的检验和有差错，TCP 将丢弃这个报文段和不确认收到 此报文段。 (校验出包有错，丢弃报文段，不给出响应，TCP 发送数据端，超时时会重发 数据)
5、既然 TCP 报文段作为 IP 数据报来传输，而 IP 数据报的到达可能会失序，因此 TCP 报 文段的到达也可能会失序。如果必要，TCP 将对收到的数据进行重新排序，将收到的数据 以正确的顺序交给应用层。 (对失序数据进行重新排序，然后才交给应用层)
6、既然 IP 数据报会发生重复，TCP 的接收端必须丢弃重复的数据。(对于重复数据，能够 丢弃重复数据)
7、TCP 还能提供流量控制。TCP 连接的每一方都有固定大小的缓冲空间。TCP 的接收端 只允许另一端发送接收端缓冲区所能接纳的数据。这将防止较快主机致使较慢主机的缓冲 区溢出。(TCP 可以进行流量控制，防止较快主机致使较慢主机的缓冲区溢出)TCP 使用的 流量控制协议是可变大小的滑动窗口协议。
8、TCP 还能提供拥塞控制。当网络拥塞时，减少数据的发送。

1.3

TCP 建立连接之后怎么保持连接（检测连接断没断）？ 

1. TCP 协议层实现的 Keepalive 机制

2.自己实现的 HeartBeat 心跳包
</li>
<li>计算机网络面试</li>
<li>计算机网络面试</li>
<li>计算机网络面试</li>
<li>计算机网络面试</li>
</ul>
</blockquote>
<p></p>
<blockquote>
<ul>
<li>Xilxi.club 西里西里(自己做的，不受其他平台限制)</li>
</ul>
</blockquote>
<p>柚子</p>
<p>麻辣烫</p>
<blockquote>
<ul>
<li>GitHub<a href="https://github.com/haiming-wen"</a>点击进入</li>
<li>喜欢的小红书<a href="https://www.xiaohongshu.com"</a> 点击进入</li>
<li>喜欢的微博<a href="https://weibo.com"</a>点击进入</li>
</ul>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="haiming-wen.github.io/2019/03/03/hello-world/" data-id="cjssmgyc10000wovhomt3r9kv" class="article-share-link">Delen</a>
      
      
    </footer>
  </div>
  
</article>


  

</section>
        
          <aside id="sidebar">
  
    <!-- Featured Tags -->

  
    <!-- Short About -->
<section class="visible-md visible-lg">
    <h5><a href="/about/">关于我们</a></h5>
    <div class="short-about">

        

        

        <!-- SNS Link -->
        <ul class="list-inline">
            
            
            

            

            

            
            
            
            
        </ul>
    </div>
</section>

  
    
  <h5>最近分类</h3>
  <div class="widget">
    <ul>
      
        <li>
          <a href="/2019/03/03/a/">Java</a>
        </li>
      
        <li>
          <a href="/2019/03/03/hello-world/">数据结构</a>
        </li>
      
    </ul>
  </div>

  
    <!-- Friends Blog -->

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Himwen_<br>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>



<script src="/js/script.js"></script>

  </div>
</body>
</html>
